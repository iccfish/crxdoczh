<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="/trunk/static/css/site.css" rel="stylesheet" type="text/css">
    <link href="/trunk/static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="/trunk/static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href="//www.google.com/images/icons/product/chrome-16.png" rel="icon" type="image/ico">
    <title>跨站 XMLHttpRequest - Google Chrome</title>
  </head>
  <body>
    <div id="branchWarning" class="displayModeWarning">
      <span><!--@WARNING: this is the trunk documentation. It may not work with the stable release of Chrome.-->警告：这是 trunk 分支的文档，不一定能在稳定版本的 Chrome 浏览器中正常工作。</span>
      <select id="branchChooser">
        <option value=""><!--@Choose a different version...-->选择另一个版本...</option>
        <option value="stable">Stable</option>
        <option value="dev">Dev</option>
        <option value="beta">Beta</option>
        <option value="trunk">Trunk</option>
      </select>
    </div>
    <a id="top"></a>
    <div id="header">
      <span id="logo">
        <a href="http://code.google.com/" id="view-original"><img src="/trunk/static/images/chrome_logo.gif" alt="单击此处查看英文原文"></a>
        <script type="text/javascript">
          document.getElementById('view-original').href = "https://developer.chrome.com" + location.pathname;
        </script>
      </span>
      <span id="cse">
        <gcse:searchbox-only enableAutoComplete="true" autoCompleteMatchTyple="prefix"></gcse:searchbox-only>
      </span>
    </div>
    <a id="gc-topnav-anchor"></a>
    <div id="gc-topnav">
      <h1>Google Chrome 扩展程序（非官方中文版）</h1>
      <ul id="home" class="gc-topnav-tabs">
        <li id="home_link">
          <!--@<a href="index.html" title="Google Chrome 扩展程序 home page"><div>Home</div></a>-->
          <a href="index.html" title="Google Chrome 扩展程序主页"><div>主页</div></a>
        </li>
        <li id="docs_link">
          <!--@<a href="docs.html" title="Official Google Chrome 扩展程序 documentation"><div>Docs</div></a>-->
          <a href="docs.html" title="Google Chrome 扩展程序文档"><div>文档</div></a>
        </li>
        <li id="faq_link">
          <!--@<a href="faq.html" title="Answers to frequently asked questions about Google Chrome 扩展程序"><div>FAQ</div></a>-->
          <a href="faq.html" title="关于 Google Chrome 扩展程序常见问题的答案"><div>常见问题</div></a>
        </li>
        <li id="samples_link">
          <!--@<a href="samples.html" title="Sample 扩展程序 (with source code)"><div>Samples</div></a>-->
          <a href="samples.html" title="示例扩展程序（包含源代码）"><div>示例</div></a>
        </li>
        <li id="group_link">
          <!--<a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 扩展程序 developer forum"><div>Group</div></a>-->
          <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 扩展程序开发人员论坛"><div>论坛（英文）</div></a>
        </li>
        <li id="so_link">
          <!--<a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="[google-chrome-extension] tag on Stack Overflow"><div>Questions?</div></a>-->
          <a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="Stack Overflow 上的 [google-chrome-extension] 标签"><div>问题？（英文）</div></a>
        </li>
      </ul>
    </div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
          <li class="level2">
                <a href="getstarted.html" class="level2 ">入门</a>
          </li>
          <li class="level2">
                <a href="overview.html" class="level2 ">概述</a>
          </li>
          <li class="level2">
                <a href="whats_new.html" class="level2 ">新增功能</a>
          </li>
          <li class="level2">
                <a href="devguide.html" class="level2 "></a>
              <ul 
                  class="level2 ">
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">浏览器用户界面</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="browserAction.html" class="level4 ">浏览器按钮</a>
                      </li>
                      <li class="level4">
                            <a href="contextMenus.html" class="level4 ">右键菜单</a>
                      </li>
                      <li class="level4">
                            <a href="notifications.html" class="level4 ">桌面通知</a>
                      </li>
                      <li class="level4">
                            <a href="omnibox.html" class="level4 ">多功能框</a>
                      </li>
                      <li class="level4">
                            <a href="options.html" class="level4 ">选项页面</a>
                      </li>
                      <li class="level4">
                            <a href="override.html" class="level4 ">替代页面</a>
                      </li>
                      <li class="level4">
                            <a href="pageAction.html" class="level4 ">页面按钮</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">浏览器交互</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="bookmarks.html" class="level4 ">书签</a>
                      </li>
                      <li class="level4">
                            <a href="cookies.html" class="level4 ">Cookie</a>
                      </li>
                      <li class="level4">
                            <a href="devtools.html" class="level4 ">开发者工具</a>
                      </li>
                      <li class="level4">
                            <a href="events.html" class="level4 ">事件</a>
                      </li>
                      <li class="level4">
                            <a href="history.html" class="level4 ">历史记录</a>
                      </li>
                      <li class="level4">
                            <a href="management.html" class="level4 ">管理</a>
                      </li>
                      <li class="level4">
                            <a href="tabs.html" class="level4 ">标签页</a>
                      </li>
                      <li class="level4">
                            <a href="windows.html" class="level4 ">窗口</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">实现</span>
                      <div class="toggleIndicator level3 toggled"></div>
                    </a>
                    <ul toggleable
                        class="level3 ">
                      <li class="level4">
                            <a href="a11y.html" class="level4 ">辅助功能</a>
                      </li>
                      <li class="level4">
                            <a href="event_pages.html" class="level4 ">事件页面</a>
                      </li>
                      <li class="level4">
                            <a href="contentSecurityPolicy.html" class="level4 ">内容安全策略</a>
                      </li>
                      <li class="level4">
                            <a href="content_scripts.html" class="level4 ">内容脚本</a>
                      </li>
                      <li class="level4">
                            <a  class="level4 selected">跨站 XHR</a>
                      </li>
                      <li class="level4">
                            <a href="i18n.html" class="level4 ">国际化支持</a>
                      </li>
                      <li class="level4">
                            <a href="messaging.html" class="level4 ">消息传递</a>
                      </li>
                      <li class="level4">
                            <a href="permissions.html" class="level4 ">可选权限</a>
                      </li>
                      <li class="level4">
                            <a href="npapi.html" class="level4 ">NPAPI 插件</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">完成</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="hosting.html" class="level4 ">托管</a>
                      </li>
                      <li class="level4">
                            <a href="external_extensions.html" class="level4 ">其他发布选项</a>
                      </li>
                    </ul>
                </li>
              </ul>
          </li>
          <li class="level2">
                <a href="tutorials.html" class="level2 ">教程</a>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="tut_migration_to_manifest_v2.html" class="level3 ">清单文件版本2</a>
                </li>
                <li class="level3">
                      <a href="tut_debugging.html" class="level3 ">调试</a>
                </li>
                <li class="level3">
                      <a href="tut_analytics.html" class="level3 ">Google Analytics（分析）</a>
                </li>
                <li class="level3">
                      <a href="tut_oauth.html" class="level3 ">OAuth</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">参考</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">格式</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="manifest.html" class="level4 ">清单文件</a>
                      </li>
                      <li class="level4">
                            <a href="match_patterns.html" class="level4 ">匹配表达式</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                      <a href="permission_warnings.html" class="level3 ">权限警告</a>
                </li>
                <li class="level3">
                      <a href="api_index.html" class="level3 ">chrome.* API</a>
                </li>
                <li class="level3">
                      <a href="api_other.html" class="level3 ">其他 API</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">更多</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="https://code.google.com/chrome/webstore/docs/index.html" class="level3 ">Chrome 网上应用店</a>
                </li>
                <li class="level3">
                      <a href="https://code.google.com/chrome/apps/docs/developers_guide.html" class="level3 ">托管应用</a>
                </li>
                <li class="level3">
                      <a href="themes.html" class="level3 ">主题背景</a>
                </li>
              </ul>
          </li>
        </ul>
      </div>
      <div id="gc-pagecontent">
        <h1 class="page_title">跨站 XMLHttpRequest</h1>
        <div id="toc">
          <h2><!--@Contents-->目录</h2>
          <ol>
            <li>
              <a href=#extension-origin>扩展程序的来源</a>
            </li>
            <li>
              <a href=#requesting-permission>请求跨站权限</a>
            </li>
            <li>
              <a href=#security-considerations>安全性考虑</a>
              <ol>
                <li><a href=#interaction-with-csp>与内容安全策略的关系</a></li>
              </ol>
            </li>
          </ol>
        </div>




<p id="classSummary">
<!--@Regular web pages can use the-->普通网页可以通过
<a href="http://www.w3.org/TR/XMLHttpRequest/">XMLHttpRequest</a>
<!--@object to send and receive data from remote servers,
but they're limited by the
<a href="http://en.wikipedia.org/wiki/Same_origin_policy">same origin policy</a>.
Extensions aren't so limited.
An extension can talk to remote servers outside of its origin,
as long as it first requests cross-origin permissions.-->
对象向远程服务器发送和接收数据，但是它们受到<a href="http://en.wikipedia.org/wiki/Same_origin_policy">相同来源策略</a>的限制。扩展程序不受这一限制，只要首先请求跨站权限，扩展程序就可以与来源范围外的远程服务器通信。
</p>

<h2 id="extension-origin"><!--@Extension origin-->扩展程序的来源</h2>
<p><!--@Each running extension exists within its own separate security origin. Without
requesting additional privileges, the extension can use
XMLHttpRequest to get resources within its installation. For example, if
an extension contains a JSON configuration file called <code>config.json</code>,
in a <code>config_resources</code> folder, the extension can retrieve the file's contents like
this:-->
每一个运行中的扩展程序在它自己的安全来源中存在，如果不请求额外的权限，扩展程序只能使用
XMLHttpRequest 获取自己的资源。例如，如果扩展程序包含一个名为 config.json
的 JSON 配置文件，位于 config_resources 文件夹中，扩展程序可以像这样获取文件内容：
</p>

<pre>
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = handleStateChange; // 在其他地方实现。
xhr.open("GET", chrome.extension.getURL('/config_resources/config.json'), true);
xhr.send();
</pre>

<p><!--@If the extension attempts to use a security origin other than itself,
say http://www.google.com,
the browser disallows it
unless the extension has requested the appropriate cross-origin permissions.-->
如果扩展程序尝试使用除了它自己的安全来源，例如 http://www.google.com，除非扩展程序已经请求了相应的跨站权限，浏览器会禁止这一请求。
</p>

<h2 id="requesting-permission"><!--@Requesting cross-origin permissions-->请求跨站权限</h2>

<p><!--@By adding hosts or host match patterns (or both) to the
<a href="manifest.html#permissions">permissions</a> section of the
<a href="manifest.html">manifest</a> file, the extension can request access to
remote servers outside of its origin.-->
通过向<a href="manifest.html">清单文件</a>的
<a href="declare_permissions.html">permissions</a>
部分添加主机或主机匹配表达式，扩展程序可以请求访问位于自己的来源外的远程服务器。
</p>

<pre>{
  "name": "我的扩展程序",
  ...
  <b>"permissions": [
    "http://www.google.com/"
  ]</b>,
  ...
}</pre>

<p><!--@Cross-origin permission values can be fully qualified host names,
like these:-->
跨站权限值可以是完整的主机名，例如：
</p>

<ul>
  <li> "http://www.google.com/" </li>
  <li> "http://www.gmail.com/" </li>
</ul>

<p><!--@Or they can be match patterns, like these:-->
或者也可以是匹配表达式，例如：
</p>

<ul>
  <li> "http://*.google.com/" </li>
  <li> "http://*/" </li>
</ul>

<p>
<!--@A match pattern of "http://*/" allows HTTP access to all reachable domains.
Note that here,
match patterns are similar to <a href="match_patterns.html">content script
match patterns</a>,
but any path information following the host is ignored.-->
"http://*/" 这一匹配表达式允许所有可及域名的访问。注意，这里的匹配表达式和<a href="match_patterns.html">内容脚本匹配表达式</a>类似，但是主机后的任何路径信息都将被忽略。
</p>

<p><!--@Also note that access is granted both by host and by scheme. If an extension
wants both secure and non-secure HTTP access to a given host or set
of hosts, it must declare the permissions separately:-->
同时注意访问权限是通过主机和协议同时授予的，如果扩展程序需要指定某个主机安全和非安全的 HTTP 访问，必须分开声明权限：
</p>

<pre>"permissions": [
  "http://www.google.com/",
  "https://www.google.com/"
]
</pre>

<h2 id="security-considerations"><!--@Security considerations-->安全性考虑</h2>

<p>
<!--@When using resources retrieved via XMLHttpRequest, your background page should
be careful not to fall victim to <a
href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site
scripting</a>.  Specifically, avoid using dangerous APIs such as the below:-->
当使用通过 XMLHttpRequest 获取的资源时，您的后台网页应该小心，以免<a href="http://en.wikipedia.org/wiki/Cross-site_scripting">跨站脚本攻击</a>。特别地，避免使用如下一些危险的 API：
</p>
<pre>background.html
===============
var xhr = new XMLHttpRequest();
xhr.open("GET", "http://api.example.com/data.json", true);
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4) {
    // 警告！可能会执行恶意脚本！
    var resp = eval("(" + xhr.responseText + ")");
    ...
  }
}
xhr.send();

background.html
===============
var xhr = new XMLHttpRequest();
xhr.open("GET", "http://api.example.com/data.json", true);
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4) {
    // 警告！可能会插入恶意脚本
    document.getElementById("resp").innerHTML = xhr.responseText;
    ...
  }
}
xhr.send();
</pre>
<p>
<!--@Instead, prefer safer APIs that do not run scripts:-->
因此，您应该首选更安全的不运行脚本的 API：
</p>
<pre>background.html
===============
var xhr = new XMLHttpRequest();
xhr.open("GET", "http://api.example.com/data.json", true);
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4) {
    // JSON.parse 不执行攻击者的脚本。
    var resp = JSON.parse(xhr.responseText);
  }
}
xhr.send();

background.html
===============
var xhr = new XMLHttpRequest();
xhr.open("GET", "http://api.example.com/data.json", true);
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4) {
    // innerText 不会让攻击者插入 HTML 元素。
    document.getElementById("resp").innerText = xhr.responseText;
  }
}
xhr.send();
</pre>
<p>
<!--@Additionally, be especially careful of resources retrieved via HTTP.  If your
extension is used on a hostile network, an network attacker (aka a <a
href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">"man-in-the-middle"</a>)
could modify the response and, potentially, attack your extension.  Instead,
prefer HTTPS whenever possible.-->
另外，当您通过 HTTP 接收资源时尤其要小心。如果您的扩展程序在不安全的网络环境中使用，网络攻击者（即<a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">中间人攻击</a>）可以修改响应，甚至可能攻击您的扩展程序。请尽可能地在可能的情况下首选 HTTPS。
</p>

<h3 id="interaction-with-csp"><!--@Interaction with Content Security Policy-->与内容安全策略的关系</h3>

<p>
<!--@If you modify the default <a href="contentSecurityPolicy.html">Content
Security Policy</a> for apps or extensions by adding a
<code>content_security_policy</code> attribute to your manifest, you'll need to
ensure that any hosts to which you'd like to connect are allowed. While the
default policy doesn't restrict connections to hosts, be careful when explicitly
adding either the <code>connect-src</code> or <code>default-src</code>
directives.-->
如果您在您的清单文件中添加 <code>content_security_policy</code>
属性修改了应用或扩展程序默认的<a href="contentSecurityPolicy.html"
>内容安全策略</a>，您需要确保您需要连接的所有主机都受到允许。尽管默认策略不限制连接到哪些主机，当您显式添加
<code>connect-src</code> 或 <code>default-src</code> 指示符时要特别注意。
</p>
      </div>
    </div>
  </body>
  <script>
    window.bootstrap = {
      api_names: [{"name":"alarms"},{"name":"bookmarks"},{"name":"browserAction"},{"name":"browsingData"},{"name":"commands"},{"name":"contentSettings"},{"name":"contextMenus"},{"name":"cookies"},{"name":"debugger"},{"name":"declarativeContent"},{"name":"declarativeWebRequest"},{"name":"devtools.inspectedWindow"},{"name":"devtools.network"},{"name":"devtools.panels"},{"name":"downloads"},{"name":"events"},{"name":"extension"},{"name":"fileBrowserHandler"},{"name":"fontSettings"},{"name":"history"},{"name":"i18n"},{"name":"idle"},{"name":"input.ime"},{"name":"management"},{"name":"omnibox"},{"name":"pageAction"},{"name":"pageCapture"},{"name":"permissions"},{"name":"privacy"},{"name":"proxy"},{"name":"pushMessaging"},{"name":"runtime"},{"name":"scriptBadge"},{"name":"sessionRestore"},{"name":"storage"},{"name":"tabCapture"},{"name":"tabs"},{"name":"topSites"},{"name":"tts"},{"name":"ttsEngine"},{"name":"types"},{"name":"webNavigation"},{"name":"webRequest"},{"name":"webstore"},{"last":true,"name":"windows"}].concat(
          [{"name":"experimental.devtools.audits"},{"name":"experimental.devtools.console"},{"name":"experimental.discovery"},{"name":"experimental.history"},{"name":"experimental.identity"},{"name":"experimental.infobars"},{"name":"experimental.processes"},{"name":"experimental.record"},{"name":"experimental.speechInput"},{"name":"experimental.systemInfo.cpu"},{"last":true,"name":"experimental.systemInfo.storage"}]),
      branchInfo: {"channels":[{"path":"stable","name":"Stable"},{"path":"dev","name":"Dev"},{"path":"beta","name":"Beta"},{"path":"trunk","name":"Trunk"}],"current":"trunk","showWarning":true}
    };
  </script>
  <div id="gc-footer">
    <div class="text">
      <p>
        <!--@Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.-->
        该页面翻译自
        <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
        与
        <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>。除非特别<a href="https://code.google.com/policies.html#restrictions">说明</a>，该页面的内容遵循
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0
        License</a>，代码示例遵循
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>。
      </p>
      <p>
        <!--@©2012 Google-->
      </p>
      <script src="/trunk/static/js/branch.js" type="text/javascript"></script>
      <script src="/trunk/static/js/sidebar.js" type="text/javascript"></script>
      <script src="/trunk/static/js/prettify.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++)
            preElements[i].classList.add('prettyprint');
          prettyPrint();
        })();
      </script>
      <script src="https://www.google-analytics.com/urchin.js" type="text/javascript"></script>
      <script src="https://www.google-analytics.com/ga.js" type="text/javascript"></script>
      <script type="text/javascript">
        // chrome doc tracking
        try {
          var engdocs = _gat._getTracker("YT-10763712-2");
          engdocs._trackPageview();
        } catch(err) {}
        // code.google.com site-wide tracking
        try {
          _uacct="UA-18071-1";
          _uanchor=1;
          _uff=0;
          urchinTracker();
        }
        catch(e) {/* urchinTracker not available. */}
      </script>
      <script>
        (function() {
          var cx = '002967670403910741006:61_cvzfqtno';
          var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
        })();
      </script>
  
    </div>
  </div>
</html>

