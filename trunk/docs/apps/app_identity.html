<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="/trunk/static/css/site.css" rel="stylesheet" type="text/css">
    <link href="/trunk/static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="/trunk/static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href="//www.google.com/images/icons/product/chrome-16.png" rel="icon" type="image/ico">
    <title>Identify User - Google Chrome</title>
  </head>
  <body>
    <a id="top"></a>
    <div id="header">
      <span id="logo">
        <a href="http://code.google.com/" id="view-original"><img src="/trunk/static/images/chrome_logo.gif" alt="单击此处查看英文原文"></a>
        <script type="text/javascript">
          document.getElementById('view-original').href = "https://developer.chrome.com" + location.pathname;
        </script>
      </span>
      <span id="cse">
        <gcse:searchbox-only enableAutoComplete="true" autoCompleteMatchTyple="prefix"></gcse:searchbox-only>
      </span>
    </div>
    <a id="gc-topnav-anchor"></a>
    <div id="gc-topnav">
      <h1>Google Chrome 应用（非官方中文版）</h1>
      <ul id="home" class="gc-topnav-tabs">
        <li id="home_link">
          <!--@<a href="index.html" title="Google Chrome 应用 home page"><div>Home</div></a>-->
          <a href="index.html" title="Google Chrome 应用主页"><div>主页</div></a>
        </li>
        <li id="docs_link">
          <!--@<a href="docs.html" title="Official Google Chrome 应用 documentation"><div>Docs</div></a>-->
          <a href="docs.html" title="Google Chrome 应用文档"><div>文档</div></a>
        </li>
        <li id="faq_link">
          <!--@<a href="faq.html" title="Answers to frequently asked questions about Google Chrome 应用"><div>FAQ</div></a>-->
          <a href="faq.html" title="关于 Google Chrome 应用常见问题的答案"><div>常见问题</div></a>
        </li>
        <li id="samples_link">
          <!--@<a href="samples.html" title="Sample 应用 (with source code)"><div>Samples</div></a>-->
          <a href="samples.html" title="示例应用（包含源代码）"><div>示例</div></a>
        </li>
        <li id="group_link">
          <!--<a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 应用 developer forum"><div>Group</div></a>-->
          <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 应用开发人员论坛"><div>论坛（英文）</div></a>
        </li>
        <li id="so_link">
          <!--<a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="[google-chrome-extension] tag on Stack Overflow"><div>Questions?</div></a>-->
          <a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="Stack Overflow 上的 [google-chrome-extension] 标签"><div>问题？（英文）</div></a>
        </li>
      </ul>
    </div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
          <li class="level2">
                <span class="level2">入门</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="about_apps.html" class="level3 ">什么是打包应用？</a>
                </li>
                <li class="level3">
                      <a href="app_architecture.html" class="level3 ">理解架构</a>
                </li>
                <li class="level3">
                      <a href="first_app.html" class="level3 ">创建您的第一个应用</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">开发</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="develop_apps.html" class="level3 ">在您开始之前</a>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">基础知识</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_lifecycle.html" class="level4 ">Manage App Lifecycle</a>
                      </li>
                      <li class="level4">
                            <a href="app_storage.html" class="level4 ">Manage Data</a>
                      </li>
                      <li class="level4">
                            <a href="offline_apps.html" class="level4 ">首先考虑离线</a>
                      </li>
                      <li class="level4">
                            <a href="app_external.html" class="level4 ">嵌入内容</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">安全和隐私权</span>
                      <div class="toggleIndicator level3 toggled"></div>
                    </a>
                    <ul toggleable
                        class="level3 ">
                      <li class="level4">
                            <a  class="level4 selected">Identify User</a>
                      </li>
                      <li class="level4">
                            <a href="app_csp.html" class="level4 ">Comply with CSP</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">通知</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                          <a class="button level4">
                            <span class="level4">云消息服务</span>
                            <div class="toggleIndicator level4"></div>
                          </a>
                          <ul toggleable
                              class="level4 hidden">
                            <li class="level5">
                                  <a href="cloudMessaging.html" class="level5 ">关于云消息服务</a>
                            </li>
                            <li class="level5">
                                  <a href="pushMessaging.html" class="level5 ">客户端参考</a>
                            </li>
                            <li class="level5">
                                  <a href="gcm_server.html" class="level5 ">服务参考</a>
                            </li>
                            <li class="level5">
                                  <a href="gcm_tos.html" class="level5 ">服务条款</a>
                            </li>
                          </ul>
                      </li>
                      <li class="level4">
                            <a href="notifications.html" class="level4 ">桌面通知</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">高级技术</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_network.html" class="level4 ">Network Communications</a>
                      </li>
                      <li class="level4">
                            <a href="app_hardware.html" class="level4 ">Access Hardware Devices</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">MVC 架构</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_frameworks.html" class="level4 ">关于 MVC 架构</a>
                      </li>
                      <li class="level4">
                            <a href="angular_framework.html" class="level4 ">用 AngularJS 建立应用</a>
                      </li>
                      <li class="level4">
                            <a href="sencha_framework.html" class="level4 ">Build Apps with Sencha Ext JS</a>
                      </li>
                    </ul>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">部署</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="publish_app.html" class="level3 ">发布</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">参考</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="manifest.html" class="level3 ">清单文件</a>
                </li>
                <li class="level3">
                      <a href="api_index.html" class="level3 ">Chrome 浏览器的 JavaScript API</a>
                </li>
                <li class="level3">
                      <a href="api_other.html" class="level3 ">支持的库</a>
                </li>
                <li class="level3">
                      <a href="app_deprecated.html" class="level3 ">禁用的网页特性</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <a href="samples.html" class="level2 ">示例</a>
          </li>
          <li class="level2">
                <a href="app_known_issues.html" class="level2 ">Known Issues</a>
          </li>
        </ul>
      </div>
      <div id="gc-pagecontent">
        <h1 class="page_title">Identify User</h1>
        <div id="toc">
          <h2><!--@Contents-->目录</h2>
          <ol>
            <li>
              <a href=#how>How it works</a>
            </li>
            <li>
              <a href=#google>Google account authentication</a>
              <ol>
                <li><a href=#add_permissions>Add permissions and upload app</a></li><li><a href=#copy_key>Copy key to your manifest</a></li><li><a href=#client_id>Get your client ID</a></li><li><a href=#update_manifest>Update your manifest</a></li><li><a href=#token>Get the token</a></li>
              </ol>
            </li>
            <li>
              <a href=#non>Non-Google account authentication</a>
              <ol>
                <li><a href=#register_provider>Register with the provider</a></li><li><a href=#permissions_provider>Add permissions for provider</a></li><li><a href=#token2>Get the token</a></li><li><a href=#interactive>Interactive versus silent mode</a></li>
              </ol>
            </li>
          </ol>
        </div>




<p>
Web authentication protocols utilize HTTP features,
but packaged apps run inside the app container;
they don’t load over HTTP and can’t perform redirects or set cookies.
</p>

<p>
Use the <a href="experimental.identity.html">Chrome Identity API</a>
to authenticate users:
the <code>getAuthToken</code> for users logged into their Google Account and
the <code>launchWebAuthFlow</code> for users logged into a non-Google account.
If your app uses its own server to authenticate users, you will need to use the latter.
</p>

<p class="note">
<b>API Samples: </b>
Want to play with the code?
Check out the
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/identity">identity</a> sample.
</p>

<h2 id="how">How it works</h2>

<p>
Apps that use Google accounts
need to specify the OAuth2 client ID
and scopes in their manifest.
When users install the apps,
the OAuth2 permissions are displayed along with the Chrome permissions.
Once a user accepts the permissions,
the apps can get the access token
using <code>getAuthToken</code>.
</p>

<p>
Apps that want to perform authentication
with any provider must call <code>launchAuthFlow</code>.
This method uses a browser pop-up to show the provider pages
and captures redirects to the specific URL patterns.
The redirect URLs are passed to the app
and the app extracts the token from the URL.
</p>

<h2 id="google">Google account authentication</h2>

<p>
Here are the five steps you need to complete:
</p>

<ol>
	<li>Add permissions to your manifest and upload your app.</li>
	<li>Copy key in the installed <code>manifest.json</code> to your source manifest.</li>
	<li>Get your client ID.</li>
	<li>Update your manifest to include the client ID and scopes.</li>
	<li>Get the authentication token.</li>
</ol>

<h3 id="add_permissions">Add permissions and upload app</h3>

<p>
The identity API is still experimental.
You need to make sure the experimental
and identity permissions are in your manifest.
You can then upload your app to the apps and extensions management page
(see <a href="publish_app.html">Publish</a>).
</p>

<pre>
"permissions": [
  "experimental",
  "identity"
 ]
</pre>

<h3 id="copy_key">Copy key to your manifest</h3>

<p>
You need to copy the key in the installed
<code>manifest.json</code> to your source manifest.
This ensures that the key isn't overridden anytime your reload your app
or share the app with other users.
It's not the most graceful task, but here's how it goes:
</p>

<ol>
  <li>Go to your <a href="http://www.chromium.org/user-experience/user-data-directory">user data
  directory</a>. Example on MacOs:
  <code>~/Library/Application\ Support/Google/Chrome/Default/Extensions</code></li>
  <li>List the installed apps and extensions and match your app ID on the apps and extensions
  management page to the same ID here.</li>
  <li>Go to the installed app directory (this will be a version within the app ID).
  Open the installed <code>manifest.json</code> (pico is a quick way to open the file).</li>
  <li>Copy the "key" in the installed <code>manifest.json</code> and paste it into your app's
  source manifest file.</li>
</ol>

<h3 id="client_id">Get your client ID</h3>

<p>
You need to register your app
in the Google APIs Console
to get the client ID:
</p>
 
<ol>
  <li>Login to the <a href="https://code.google.com/apis/console/">Google APIs Console</a>
  using the same Google account used to upload your app to the Chrome Web Store. </li>
  <li>Create a new project by expanding the drop-down menu in the top-left
  corner and selecting the <strong>Create...</strong> menu item. </li>
  <li> Once created and named, go to the "Services" navigation menu item and
  turn on any Google services your app needs. </li>
  <li> Go to the "API Access" navigation menu item and click on the
  <strong>Create an OAuth 2.0 client ID...</strong> blue button. </li>
  <li> Enter the requested branding information,
  select the <strong>Installed application</strong> type. </li>
  <li> Select <strong>Chrome Application</strong> and enter your application ID
  (same ID displayed in the apps and extensions management page). </li>
</ol>

<p class="warning">
<strong>Warning: </strong>
If the app ID here does not match your app ID,
an error will occur when your app calls <a href="#token">getAuthToken()</a>.
</p>

<h3 id="update_manifest">Update your manifest</h3>

<p>
You need to update your manifest to include
the client ID and scopes.
Here's the sample "oauth2" for the
<a href="https://github.com/GoogleChrome/chrome-app-samples/tree/master/gdocs">gdocs sample</a>:
</p>

<pre>
"oauth2": {
    "client_id": "665859454684.apps.googleusercontent.com",
    "scopes": [
      "https://docs.google.com/feeds/",
      "https://docs.googleusercontent.com/",
      "https://spreadsheets.google.com/feeds/",
      "https://www.googleapis.com/auth/drive.file"
    ]
  }
</pre>

<h3 id="token">Get the token</h3>

<p>
You are now ready to get the auth token:
</p>

<pre>
chrome.experimental.identity.getAuthToken(function(token) { })
</pre>

<h2 id="non">Non-Google account authentication</h2>

<p>
Here are the three steps you need to complete:
</p>

<ol>
	<li>Register with the provider.</li>
	<li>Add permissions for provider resources that your app will access.</li>
	<li>Get the authentication token.</li>
</ol>

<h3 id="register_provider">Register with the provider</h3>

<p>
You need to register an OAuth2 client ID with the provider
and configure the client ID as a website.
For the  redirect URI to be entered during registration,
use the URL of the form:
<code>https://<extension-id>.chromiumapp.org/<anything-here></code>
</p>

<p>
For example, if you app ID is abcdefghijklmnopqrstuvwxyzabcdef and
you want provider_cb to be the path,
to distinguish it with redirect URIs from other providers,
you should use:
<code>https://abcdefghijklmnopqrstuvwxyzabcdef.chromiumapp.org/provider_cb</code>
</p>

<h3 id="permissions_provider">Add permissions for provider</h3>

<p>
To make cross-original XHRs to Google API endpoints,
you need to whitelist those patterns in the permissions:
</p>

<pre>
"permissions": [
  ...
  "https://docs.google.com/feeds/",
  "https://docs.googleusercontent.com/",
  “https://www.website-of-provider-with-user-photos.com/photos/”
]
</pre>

<h3 id="token2">Get the token</h3>

<p>
To get the token:
</p>

<pre>
chrome.experimental.identity.launchWebAuthFlow(
  {‘url’: ‘&lt;url-to-do-auth>’, ‘interactive’: true},
  function(redirect_url) { // Extract token from redirect_url });
</pre>

<p>
The &lt;url-to-do-auth> is whatever the URL is to do auth to the provider from a website.
For example, let us say that you are performing OAuth2 flow with a provider
and have registered your app with client id 123456789012345 and
you want access to user’s photos on the provider’s website:
<code>https://www.website-of-provider-with-user-photos.com/dialog/oauth?client_id=123456789012345&amp;<br>redirect_uri=https://abcdefghijklmnopqrstuvwxyzabcdef.chromiumapp.org/provider_cb&amp;response_type=token&amp;scope=user_photos</code>
</p>

<p>
The provider will perform authentication and if appropriate,
will show login and/or approval UI to the user.
It will then redirect to
<code>https://abcdefghijklmnopqrstuvwxyzabcdef.chromiumapp.org/provider_cb#authToken=&lt;auth-token></code>
</p>

<p>
Chrome will capture that and invoke the callback
of the app with the full redirect URL.
The app should extract the token out of the URL.
</p>

<h3 id="interactive">Interactive versus silent mode</h3>

<p>
When calling <code>launchWebAuthFlow</code>,
you can pass a flag (‘interactive’: true in the example above)
indicating whether you want the API to be called
in interactive mode or not (aka silent mode).
If you invoke the API in interactive mode,
the user is shown UI, if necessary,
to get the token (signin UI and/or approval UI;
or for that matter any provider specific UI).
</p>

<p>
If you invoke the API in silent mode,
the API will only return a token if the provider is able
to provide a token without showing any UI.
This is useful in cases when an app is doing the flow at app startup, for example,
or in general in cases where there is no user gesture involved.
</p>

<p>
The best practice we suggest is to use silent mode
when there is no user gesture involved and use interactive mode
if there is a user gesture (for example, the user clicked the Sign In button in your app).
Note that we do not enforce gesture requirement.
</p>

<p class="backtotop"><a href="#top">Back to top</a></p>
<p class="backtotop"><a href="#top"><!--@Back to top-->回到顶部</a></p>
      </div>
    </div>
  </body>
  <script>
    window.bootstrap = {
      api_names: [{"name":"alarms"},{"name":"app.runtime"},{"name":"app.window"},{"name":"bluetooth"},{"name":"commands"},{"name":"contextMenus"},{"name":"events"},{"name":"fileSystem"},{"name":"i18n"},{"name":"idle"},{"name":"mediaGalleries"},{"name":"permissions"},{"name":"pushMessaging"},{"name":"runtime"},{"name":"serial"},{"name":"socket"},{"name":"storage"},{"name":"tts"},{"name":"types"},{"name":"usb"},{"last":true,"name":"webstore"}].concat(
          [{"name":"experimental.app"},{"name":"experimental.identity"},{"name":"experimental.mediaGalleries"},{"name":"experimental.record"},{"name":"experimental.systemInfo.cpu"},{"name":"experimental.systemInfo.display"},{"name":"experimental.systemInfo.memory"},{"last":true,"name":"experimental.systemInfo.storage"}]),
      branchInfo: {"channels":[{"path":"stable","name":"Stable"},{"path":"dev","name":"Dev"},{"path":"beta","name":"Beta"},{"path":"trunk","name":"Trunk"}],"current":"trunk","showWarning":false}
    };
  </script>
  <div id="gc-footer">
    <div class="text">
      <p>
        <!--@Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.-->
        该页面翻译自
        <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
        与
        <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>。除非特别<a href="https://code.google.com/policies.html#restrictions">说明</a>，该页面的内容遵循
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0
        License</a>，代码示例遵循
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>。
      </p>
      <p>
        <!--@©2012 Google-->
      </p>
      <script src="/trunk/static/js/branch.js" type="text/javascript"></script>
      <script src="/trunk/static/js/sidebar.js" type="text/javascript"></script>
      <script src="/trunk/static/js/prettify.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++)
            preElements[i].classList.add('prettyprint');
          prettyPrint();
        })();
      </script>
      <script src="https://www.google-analytics.com/urchin.js" type="text/javascript"></script>
      <script src="https://www.google-analytics.com/ga.js" type="text/javascript"></script>
      <script type="text/javascript">
        // chrome doc tracking
        try {
          var engdocs = _gat._getTracker("YT-10763712-2");
          engdocs._trackPageview();
        } catch(err) {}
        // code.google.com site-wide tracking
        try {
          _uacct="UA-18071-1";
          _uanchor=1;
          _uff=0;
          urchinTracker();
        }
        catch(e) {/* urchinTracker not available. */}
      </script>
      <script>
        (function() {
          var cx = '002967670403910741006:61_cvzfqtno';
          var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
        })();
      </script>
  
    </div>
  </div>
</html>

