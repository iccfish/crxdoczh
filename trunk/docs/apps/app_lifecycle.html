<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="/trunk/static/css/site.css" rel="stylesheet" type="text/css">
    <link href="/trunk/static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="/trunk/static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href="//www.google.com/images/icons/product/chrome-16.png" rel="icon" type="image/ico">
    <title>管理应用的生命周期 - Google Chrome</title>
  </head>
  <body>
    <a id="top"></a>
    <div id="header">
      <span id="logo">
        <a href="http://code.google.com/" id="view-original"><img src="/trunk/static/images/chrome_logo.gif" alt="单击此处查看英文原文"></a>
        <script type="text/javascript">
          document.getElementById('view-original').href = "https://developer.chrome.com" + location.pathname;
        </script>
      </span>
      <span id="cse">
        <gcse:searchbox-only enableAutoComplete="true" autoCompleteMatchTyple="prefix"></gcse:searchbox-only>
      </span>
    </div>
    <a id="gc-topnav-anchor"></a>
    <div id="gc-topnav">
      <h1>Google Chrome 应用（非官方中文版）</h1>
      <ul id="home" class="gc-topnav-tabs">
        <li id="home_link">
          <!--@<a href="index.html" title="Google Chrome 应用 home page"><div>Home</div></a>-->
          <a href="index.html" title="Google Chrome 应用主页"><div>主页</div></a>
        </li>
        <li id="docs_link">
          <!--@<a href="docs.html" title="Official Google Chrome 应用 documentation"><div>Docs</div></a>-->
          <a href="docs.html" title="Google Chrome 应用文档"><div>文档</div></a>
        </li>
        <li id="faq_link">
          <!--@<a href="faq.html" title="Answers to frequently asked questions about Google Chrome 应用"><div>FAQ</div></a>-->
          <a href="faq.html" title="关于 Google Chrome 应用常见问题的答案"><div>常见问题</div></a>
        </li>
        <li id="samples_link">
          <!--@<a href="samples.html" title="Sample 应用 (with source code)"><div>Samples</div></a>-->
          <a href="samples.html" title="示例应用（包含源代码）"><div>示例</div></a>
        </li>
        <li id="group_link">
          <!--<a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 应用 developer forum"><div>Group</div></a>-->
          <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions" title="Google Chrome 应用开发人员论坛"><div>论坛（英文）</div></a>
        </li>
        <li id="so_link">
          <!--<a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="[google-chrome-extension] tag on Stack Overflow"><div>Questions?</div></a>-->
          <a href="http://stackoverflow.com/questions/tagged/google-chrome-extension" title="Stack Overflow 上的 [google-chrome-extension] 标签"><div>问题？（英文）</div></a>
        </li>
      </ul>
    </div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul 
            class="level1 ">
          <li class="level2">
                <span class="level2">入门</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="about_apps.html" class="level3 ">什么是打包应用？</a>
                </li>
                <li class="level3">
                      <a href="app_architecture.html" class="level3 ">理解架构</a>
                </li>
                <li class="level3">
                      <a href="first_app.html" class="level3 ">创建您的第一个应用</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">开发</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="develop_apps.html" class="level3 ">在您开始之前</a>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">基础知识</span>
                      <div class="toggleIndicator level3 toggled"></div>
                    </a>
                    <ul toggleable
                        class="level3 ">
                      <li class="level4">
                            <a  class="level4 selected">管理应用的生命周期</a>
                      </li>
                      <li class="level4">
                            <a href="app_storage.html" class="level4 ">Manage Data</a>
                      </li>
                      <li class="level4">
                            <a href="offline_apps.html" class="level4 ">首先考虑离线</a>
                      </li>
                      <li class="level4">
                            <a href="app_external.html" class="level4 ">嵌入内容</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">安全和隐私权</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_identity.html" class="level4 ">Identify User</a>
                      </li>
                      <li class="level4">
                            <a href="app_csp.html" class="level4 ">Comply with CSP</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">通知</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                          <a class="button level4">
                            <span class="level4">云消息服务</span>
                            <div class="toggleIndicator level4"></div>
                          </a>
                          <ul toggleable
                              class="level4 hidden">
                            <li class="level5">
                                  <a href="cloudMessaging.html" class="level5 ">关于云消息服务</a>
                            </li>
                            <li class="level5">
                                  <a href="pushMessaging.html" class="level5 ">客户端参考</a>
                            </li>
                            <li class="level5">
                                  <a href="gcm_server.html" class="level5 ">服务参考</a>
                            </li>
                            <li class="level5">
                                  <a href="gcm_tos.html" class="level5 ">服务条款</a>
                            </li>
                          </ul>
                      </li>
                      <li class="level4">
                            <a href="notifications.html" class="level4 ">桌面通知</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">高级技术</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_network.html" class="level4 ">网络通信</a>
                      </li>
                      <li class="level4">
                            <a href="app_hardware.html" class="level4 ">访问硬件设备</a>
                      </li>
                    </ul>
                </li>
                <li class="level3">
                    <a class="button level3">
                      <span class="level3">MVC 架构</span>
                      <div class="toggleIndicator level3"></div>
                    </a>
                    <ul toggleable
                        class="level3 hidden">
                      <li class="level4">
                            <a href="app_frameworks.html" class="level4 ">关于 MVC 架构</a>
                      </li>
                      <li class="level4">
                            <a href="angular_framework.html" class="level4 ">用 AngularJS 建立应用</a>
                      </li>
                      <li class="level4">
                            <a href="sencha_framework.html" class="level4 ">用 Sencha Ext JS 建立应用</a>
                      </li>
                    </ul>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">部署</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="publish_app.html" class="level3 ">发布</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <span class="level2">参考</span>
              <ul 
                  class="level2 ">
                <li class="level3">
                      <a href="manifest.html" class="level3 ">清单文件</a>
                </li>
                <li class="level3">
                      <a href="api_index.html" class="level3 ">Chrome 浏览器的 JavaScript API</a>
                </li>
                <li class="level3">
                      <a href="api_other.html" class="level3 ">支持的库</a>
                </li>
                <li class="level3">
                      <a href="app_deprecated.html" class="level3 ">禁用的网页特性</a>
                </li>
              </ul>
          </li>
          <li class="level2">
                <a href="samples.html" class="level2 ">示例</a>
          </li>
          <li class="level2">
                <a href="app_known_issues.html" class="level2 ">Known Issues</a>
          </li>
        </ul>
      </div>
      <div id="gc-pagecontent">
        <h1 class="page_title">管理应用的生命周期</h1>
        <div id="toc">
          <h2><!--@Contents-->目录</h2>
          <ol>
            <li>
              <a href=#lifecycle>生命周期的工作方式</a>
            </li>
            <li>
              <a href=#eventpage>创建事件页面和窗口</a>
              <ol>
                <li><a href=#create_event_page>创建事件页面</a></li><li><a href=#create_windows>创建窗口</a></li><li><a href=#launch_data>包含执行数据</a></li>
              </ol>
            </li>
            <li>
              <a href=#runtime>监听应用的运行时事件</a>
              <ol>
                <li><a href=#local_settings>储存本地设置</a></li><li><a href=#preventing_loss>防止数据丢失</a></li><li><a href=#clean-up>应用关闭前的清理</a></li>
              </ol>
            </li>
          </ol>
        </div>

<meta name="doc-family" content="apps">



<p>
<!--@The app runtime and event page are responsible
for managing the app lifecycle.
The app runtime manages app installation,
controls the event page,
and can shutdown the app at anytime.
The event page listens out for events from the app runtime
and manages what gets launched and how.-->
应用运行时环境与事件页面用于管理应用的生命周期。应用运行时环境管理应用的安装，控制事件页面，并且能够在任何时候关闭应用。事件页面监听来自应用运行时环境的事件，并管理运行的内容与方式。
</p>

<h2 id="lifecycle"><!--@How the lifecycle works-->生命周期的工作方式</h2>

<p>
<!--@The app runtime loads the event page
from a user's desktop and
the <code>onLaunch()</code> event is fired.
This event tells the event page what windows
to launch and their dimensions.
The lifecycle diagram here isn't the nicest to look at,
but it's practical (and we will make it nicer soon).-->
应用程序运行时环境从用户的桌面载入事件页面，并产生
<code>onLaunched()</code>
事件。该事件告诉事件页面要打开的窗口及其大小。生命周期示意图不太好看，但是很实际（我们很快就会让它变得更好看）。
</p>

<img src="/trunk/static/images/applifecycle.png"
     width="444"
     height="329"
     alt="how app lifecycle works">

<p>
<!--@When the event page has no executing JavaScript,
no pending callbacks, and no open windows,
the runtime unloads the event page and closes the app.
Before unloading the event page,
the <code>onSuspend()</code> event is fired.
This gives the event page opportunity
to do simple clean-up tasks
before the app is closed.-->
当事件页面不执行
JavaScript，没有未决的回调函数，也没有打开的窗口时，运行时环境会卸载事件页面，并关闭应用。在卸载事件页面之前，将产生
<code>onSuspend()</code>
事件，这样使事件页面有机会在应用关闭之前做一些简单的清理任务。
</p>

<h2 id="eventpage"><!--@Create event page and windows-->创建事件页面和窗口</h2>

<p>
<!--@All apps must have an event page.
This page contains the top-level logic of the application
with none of its own UI and is responsible
for creating the windows for all other app pages.-->
所有应用都必须有一个事件页面，该页面包含了应用的顶层逻辑，但没有任何自己的用户界面，用于为所有其他应用页面创建窗口。
</p>

<h3 id="create_event_page"><!--@Create event page-->创建事件页面</h3>

<p>
<!--@To create the event page,
include the "background" field in the app manifest
and include the <code>background.js</code> in the scripts array.
Any library scripts used by the event page need to be added
to the "background" field first:-->
要创建事件页面，在应用程序的清单文件中包含 "background" 字段，并将
<code>background.js</code>
包含在脚本（"scripts"）数组中。事件页面使用的所有库脚本需要首先加入
"backrgound" 字段：
</p>

<pre>
"background": {
  "scripts": [
    "foo.js",
    "background.js"
  ]
}
</pre>

<p>
<!--@Your event page must include the <code>onLaunched()</code> function.
This function is called
when your application is launched in any way:-->
您的事件页面必须包含 <code>onLaunched()</code>
函数，当您的应用以任何方式执行时会调用该函数：
</p>

<pre>
chrome.app.runtime.onLaunched.addListener(function() { 
  // 告诉您的应用执行的内容与方式。
});
</pre>

<h3 id="create_windows"><!--@Create windows-->创建窗口</h3>

<p>
<!--@An event page may create one or more windows at its discretion.
By default, these windows are created with a script connection
to the event page and are directly scriptable by the event page.-->
事件页面可以创建一个或多个指定大小的窗口。默认情况下，这些创建的窗口与事件页面之间有脚本连接，并且可以直接由事件页面调用。
</p>

<p>
<!--@Windows can either be shells or panels.
Shell windows have no browser chrome.
Panel windows are the same as shell windows,
except they have different size and position restrictions,
for example, a chat panel.-->
窗口可以为外壳或面板。外壳窗口没有浏览器界面，面板窗口与外壳窗口类似，区别在于它们的大小与位置限制，例如聊天面板。
</p>

<p><!--@Here's a sample <code>background.js</code>
  with a 'shell' window:-->
  如下是创建外壳（'shell'）窗口的示例
  <code>backrgound.js</code>：
</p>

<pre>
chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('main.html', {
    width: 800,
    height: 600,
    minWidth: 800,
    minHeight: 600,
    left: 100,
    top: 100,
    type: 'shell'
  });
});
</pre>

<p><!--@Here's a sample <code>background.js</code>
  with a 'panel' window:-->
  如下是创建面板（'panel'）窗口的示例
  <code>backrgound.js</code>：
</p>

<pre>
chrome.app.runtime.onLaunched.addListener(function() {
  chrome.app.window.create('index.html', {
    width: 400,
    height: 200,
    type: 'panel'
  });
});
</pre>

<h3 id="launch_data"><!--@Including Launch Data-->包含执行数据</h3>

<p>
<!--@Depending on how your app is launched,
you may need to handle launch data
in your event page.
By default, there is no launch data
when the app is started by the app launcher.
For apps that have file handlers,
you need to handle the
<code>launchData.items</code> parameter to allow
them to be launched with files.-->
取决于您的应用的执行方式，您可能需要在事件页面中包含执行数据。默认情况下，应用启动器启动应用时没有执行数据。对于包含文件处理程序的应用，您需要处理
<code>launchData.items</code> 参数允许它们与文件一起执行。
</p>

<h2 id="runtime"><!--@Listening for app runtime events-->监听应用的运行时事件</h2>

<p>
<!--@The app runtime controls the app installs, updates, and uninstalls.
You don't need to do anything to set up the app runtime,
but your event page can listen out for the <code>onInstalled()</code> event
to store local settings and the
<code>onSuspend()</code> event to do simple clean-up tasks
before the event page is unloaded.-->
应用运行时环境控制应用的安装、更新与卸载。您不需要做任何事情来设置应用运行时环境，但是您的事件页面可以监听
<code>onInstalled()</code> 事件来储存本地设置，监听
<code>onSuspend()</code> 事件在事件页面卸载前做一些简单的清理任务。
</p>

<h3 id="local_settings"><!--@Storing local settings-->储存本地设置</h3>

<p>
<!--@<code>chrome.runtime.onInstalled()</code>
is called when your app has first been installed,
or when it has been updated.
Any time this function is called,
the <code>onInstalled</code> event is fired.
The event page can listen for this event and use the
<a href="storage.html">Storage API</a>
to store and update local settings
(see also <a href="app_storage.html#options">Storage options</a>).-->
当您的应用程序首次安装或者更新时将调用
<code>chrome.runtime.onInstalled()</code>，每次调用该函数时将产生
<code>onInstalled</code>
事件。事件页面可以监听该事件，并使用<a href="storage.html">存储 API</a>
储存和更新本地设置（同时请参见<a href="app_storage.html#options">存储选项</a>）。
</p>

<pre>
chrome.runtime.onInstalled.addListener(function() { 
  chrome.storage.local.set(object items, function callback);
});
</pre>

<h3 id="preventing_loss"><!--@Preventing data loss-->防止数据丢失</h3>

<p>
<!--@Users can uninstall your app at any time.
When uninstalled,
no executing code or private data is left behind.
This can lead to data loss
since the users may be uninstalling an app
that has locally edited, unsynchronized data.
You should stash data to prevent data loss.-->
用户可以在任何时候卸载您的应用，卸载后不会留下任何可执行代码或私有数据。这样可能会导致数据丢失，因为用户正在卸载的应用可能包含本地编辑过但尚未同步的数据，您应该储存数据以免数据丢失。
</p>

<p>
<!--@At a minimum,
you should store user settings
so that if users reinstall your app,
their information is still available for reuse.
Using the Storage API
(<a href="storage.html#property-sync">storage.sync</a>),
user data can be automatically synced
with Chrome sync.-->
至少，您应该存储用户设置，以便用户重新安装您的应用后，它们的信息仍然可以重新使用。使用存储
API（<a href="storage.html#property-sync">storage.sync</a>），用户数据可以自动通过 Chrome 浏览器的同步功能同步。
</p>

<h3 id="clean-up"><!--@Clean-up before app closes-->应用关闭前的清理</h3>

<p>
<!--@The app runtime sends the <code>onSuspend()</code>
event to the event page before unloading it.
Your event page can listen out for this event and
do clean-up tasks before the app closes.-->
应用运行时环境在卸载前会向事件页面发送 <code>onSuspend()</code>
事件，您的事件页面可以监听该事件并在应用关闭前做清理任务。
</p>

<p>
<!--@Once this event is fired,
the app runtime starts the process of closing the app:
all events stop firing and
JavaScript execution is halted.
Any asynchronous operations started
while handling this event are not guaranteed to complete.
Keep the clean-up tasks synchronous and simple.-->
一旦产生了该事件，应用运行时环境就开始了应用关闭的过程。所有事件不再产生，JavaScript
执行将停止。处理这一事件时开始的任何异步操作都不能保证完整。请保持清理任务同步而且简单：
</p>

<pre>
chrome.runtime.onSuspend.addListener(function() { 
  // 做一些简单的清理任务。
});
</pre>

<p class="backtotop"><a href="#top"><!--@Back to top-->回到顶部</a></p>
      </div>
    </div>
  </body>
  <script>
    window.bootstrap = {
      api_names: [{"name":"alarms"},{"name":"app.runtime"},{"name":"app.window"},{"name":"bluetooth"},{"name":"commands"},{"name":"contextMenus"},{"name":"events"},{"name":"fileSystem"},{"name":"i18n"},{"name":"idle"},{"name":"mediaGalleries"},{"name":"permissions"},{"name":"pushMessaging"},{"name":"runtime"},{"name":"serial"},{"name":"socket"},{"name":"storage"},{"name":"tts"},{"name":"types"},{"name":"usb"},{"last":true,"name":"webstore"}].concat(
          [{"name":"experimental.app"},{"name":"experimental.identity"},{"name":"experimental.mediaGalleries"},{"name":"experimental.record"},{"name":"experimental.systemInfo.cpu"},{"name":"experimental.systemInfo.display"},{"name":"experimental.systemInfo.memory"},{"last":true,"name":"experimental.systemInfo.storage"}]),
      branchInfo: {"channels":[{"path":"stable","name":"Stable"},{"path":"dev","name":"Dev"},{"path":"beta","name":"Beta"},{"path":"trunk","name":"Trunk"}],"current":"trunk","showWarning":false}
    };
  </script>
  <div id="gc-footer">
    <div class="text">
      <p>
        <!--@Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.-->
        该页面翻译自
        <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
        与
        <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>。除非特别<a href="https://code.google.com/policies.html#restrictions">说明</a>，该页面的内容遵循
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0
        License</a>，代码示例遵循
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>。
      </p>
      <p>
        <!--@©2012 Google-->
      </p>
      <script src="/trunk/static/js/branch.js" type="text/javascript"></script>
      <script src="/trunk/static/js/sidebar.js" type="text/javascript"></script>
      <script src="/trunk/static/js/prettify.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++)
            preElements[i].classList.add('prettyprint');
          prettyPrint();
        })();
      </script>
      <script src="https://www.google-analytics.com/urchin.js" type="text/javascript"></script>
      <script src="https://www.google-analytics.com/ga.js" type="text/javascript"></script>
      <script type="text/javascript">
        // chrome doc tracking
        try {
          var engdocs = _gat._getTracker("YT-10763712-2");
          engdocs._trackPageview();
        } catch(err) {}
        // code.google.com site-wide tracking
        try {
          _uacct="UA-18071-1";
          _uanchor=1;
          _uff=0;
          urchinTracker();
        }
        catch(e) {/* urchinTracker not available. */}
      </script>
      <script>
        (function() {
          var cx = '002967670403910741006:61_cvzfqtno';
          var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
        })();
      </script>
  
    </div>
  </div>
</html>

